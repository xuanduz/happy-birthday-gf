<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Happy Birthday ‚Äî For Her üéÄ</title>
    <style>
        /* Target primarily iPhone 14 Pro Max viewport (430x932) but remain responsive */
        :root {
            --bg1: #ffd6e8;
            --bg2: #ffb6d5;
            --accent: #ff6fa3;
            --muted: #fff6fb;
            --card: #ffffffcc;
            --glass: rgba(255, 255, 255, 0.18);
            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            background: linear-gradient(180deg, var(--bg1), var(--bg2));
            -webkit-tap-highlight-color: transparent;
        }

        .wrap {
            width: 100%;
            height: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .card {
            width: 430px;
            max-width: 96vw;
            /* designed for 430 */
            height: 932px;
            max-height: 96vh;
            /* designed for 932 */
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.08));
            border-radius: 28px;
            box-shadow: 0 12px 40px rgba(255, 105, 180, 0.15);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 28px;
            box-sizing: border-box;
            backdrop-filter: blur(6px);
        }

        header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .logo .heart {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent), #ff9fcf);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 18px rgba(255, 111, 163, 0.24)
        }

        .logo .heart svg {
            width: 22px;
            height: 22px;
            filter: drop-shadow(0 2px 6px rgba(255, 111, 163, 0.18))
        }

        h1 {
            font-size: 28px;
            margin: 6px 0 0 0;
            color: #5b1736;
            letter-spacing: 0.6px
        }

        .subtitle {
            font-size: 13px;
            color: #7a2543;
            opacity: 0.9
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
            width: 100%;
            text-align: center;
            padding: 6px 12px;
            box-sizing: border-box;
        }

        .main .contents {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 18px;
            width: 100%;
            text-align: center;
            margin-top: 30px;
        }

        .photo {
            width: 78%;
            max-width: 320px;
            aspect-ratio: 1/1;
            border-radius: 22px;
            background: linear-gradient(180deg, #fff, #ffeaf6);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.5)
        }

        .photo img {
            width: 110%;
            height: 110%;
            object-fit: cover
        }

        .greeting {
            font-size: 20px;
            font-weight: 600;
            color: #4b0f2a
        }

        .message {
            font-size: 14px;
            color: #5f233a;
            line-height: 1.35;
            max-width: 86%;
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center
        }

        .btn {
            background: var(--accent);
            color: white;
            padding: 10px 10px;
            border-radius: 14px;
            border: none;
            font-weight: 700;
            font-size: 15px;
            box-shadow: 0 8px 18px rgba(255, 111, 163, 0.18);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            cursor: pointer
        }

        .btn.secondary {
            background: rgba(245, 245, 245, 0.733);
            color: #5b1736;
            border: 2px solid rgba(91, 23, 54, 0.08);
            font-weight: 600
        }

        .btn:active {
            transform: translateY(1px)
        }

        footer {
            width: 100%;
            display: flex;
            justify-content: center;
            padding-bottom: 6px
        }

        .note {
            font-size: 12px;
            color: #5b1736;
            opacity: 0.7
        }

        /* Play icon */
        .playico {
            width: 18px;
            height: 18px
        }

        /* Confetti canvas sits on top */
        canvas.confetti {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99
        }

        /* small upload label */
        .upload {
            font-size: 12px;
            color: #6b2340;
            background: rgba(255, 255, 255, 0.18);
            padding: 8px 10px;
            border-radius: 10px
        }

        @media (max-width:440px) {
            .card {
                height: calc(100vh - 40px);
                border-radius: 20px;
                padding: 18px
            }

            h1 {
                font-size: 22px
            }

            .greeting {
                font-size: 18px
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="card" role="main" aria-label="Happy birthday card">
            <canvas class="confetti" id="confettiCanvas"></canvas>
            <header>
                <div class="logo">
                    <div class="heart" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12 21s-7.5-4.93-9.33-7.02C.88 10.9 3.47 5.5 8.01 6.14 9.88 6.44 11 8 12 9.2 13 8 14.12 6.44 15.99 6.14c4.54-.64 7.13 4.76 5.34 7.84C19.5 16.07 12 21 12 21z" />
                        </svg>
                    </div>
                    <div>
                        <h1 style="margin-top: 0;">Happy Birthday!</h1>
                        <div class="subtitle">M·ªôt ƒëi·ªÅu nh·ªè ng·ªçt ng√†o cho em
                            üíï</div>
                    </div>
                </div>
            </header>

            <section class="main">
                <div class="contents">
                    <div class="photo" id="photoArea">
                        <img src="./avt_mai3.jpg" alt="photo" style="width:100%;height:100%;object-fit:cover;"/>
                    </div>

                    <div class="greeting">Ch√∫c m·ª´ng sinh nh·∫≠t b√© Mai üéÇ</div>
                    <div class="message" id="message">Anh xin g·ª≠i em nh·ªØng l·ªùi ch√∫c sinh nh·∫≠t vui v·∫ª, ·∫•m √°p. <br/>
                        Ch√∫c em lu√¥n m·∫°nh kh·ªèe, th√†nh c√¥ng, xinh ƒë·∫πp, h·∫°nh ph√∫c h∆°n, c∆∞·ªùi nhi·ªÅu h∆°n m·ªói ng√†y üíñ
                        <br/>
                        ‚òÜ*: .ÔΩ°. o(‚âß‚ñΩ‚â¶)o .ÔΩ°.:*‚òÜ
                    </div>
                </div>

                <div class="controls">
                    <button class="btn" id="playBtn" aria-pressed="false">
                        <svg class="playico" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 3v18l15-9L5 3z" fill="white" />
                        </svg>
                        Play nh·∫°c
                    </button>

                    <button class="btn secondary" id="chimeBtn" aria-pressed="false">
                        <svg class="playico" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <g stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none">
                            <path d="M12 3v6" />
                            <path d="M12 15v6" />
                            <path d="M4.2 4.2l3 3" />
                            <path d="M16.8 16.8l3 3" />
                            <path d="M3 12h6" />
                            <path d="M15 12h6" />
                            <circle cx="12" cy="12" r="2.6" fill="currentColor" />
                        </g>
                        </svg>
                        Ph√°o hoaaa
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Simple confetti implementation
        const canvas = document.getElementById('confettiCanvas');
        const ctx = canvas.getContext('2d');
        let W, H, particles = [];
        function resize() { W = canvas.width = canvas.clientWidth; H = canvas.height = canvas.clientHeight; }
        window.addEventListener('resize', resize); resize();
        function random(min, max) { return Math.random() * (max - min) + min }
        function makeParticle(x, y) { return { x, y: y || -10, vx: random(-1.5, 1.5), vy: random(1, 3), size: random(6, 12), color: `hsl(${random(1, 350)},80%,60%)`, rot: random(0, 360), vr: random(-7, 7), life: 120 + Math.floor(random(0, 60)) } }
        function launchConfetti(amount = 40) { for (let i = 0; i < amount; i++)particles.push(makeParticle(random(W * 0.2, W * 0.8), random(H * 0.1, H * 0.5))) }
        function render() { ctx.clearRect(0, 0, W, H); for (let p of particles) { p.x += p.vx; p.y += p.vy; p.vy += 0.03; p.rot += p.vr; p.life--; ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot * Math.PI / 180); ctx.fillStyle = p.color; ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 0.6); ctx.restore(); } particles = particles.filter(p => p.life > 0 && p.y < H + 50); requestAnimationFrame(render); } render();

        // WebAudio: small happy-birthday tune and short chime
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let ac = null; let isPlaying = false; let bgOsc = null, bgGain = null;

        function ensureContext() { if (!ac) ac = new AudioContext(); }

        // notes for 'Happy Birthday' (approx) in frequencies (C4=261.63)
        const notes = {
            C4: 261.63, D4: 293.66, E4: 329.63, F4: 349.23, G4: 392.00, A4: 440.00, B4: 493.88, C5: 523.25, D5: 587.33
        };
        // melody (note, duration multiplier)
        const melody = [
            ['G4', 0.75], ['G4', 0.25], ['A4', 1], ['G4', 1], ['C5', 1], ['B4', 2],
            ['G4', 0.75], ['G4', 0.25], ['A4', 1], ['G4', 1], ['D5', 1], ['C5', 2],
            ['G4', 0.75], ['G4', 0.25], ['G5', 1], ['E5', 1], ['C5', 1], ['B4', 1], ['A4', 2],
            ['F5', 0.75], ['F5', 0.25], ['E5', 1], ['C5', 1], ['D5', 1], ['C5', 2]
        ];
        // helper to get frequency, default to A4 if unknown
        function freqOf(name) {
            if (!name) return 440; if (notes[name]) return notes[name]; // handle high octave names
            if (name.endsWith('5')) { const base = name[0]; if (base === 'G') return 783.99; if (base === 'E') return 659.26; if (base === 'F') return 698.46; if (base === 'D') return 587.33; if (base === 'B') return 987.77; }
            return 440;
        }

        function playMelody() {
            ensureContext(); if (ac.state === 'suspended') ac.resume(); const t0 = ac.currentTime + 0.05; let t = t0; const tempo = 0.65; // seconds per beat
            for (const [n, d] of melody) {
                const f = freqOf(n); const dur = tempo * d;
                const o = ac.createOscillator(); const g = ac.createGain(); o.type = 'sine'; o.frequency.setValueAtTime(f, t);
                g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.18, t + 0.02); g.gain.exponentialRampToValueAtTime(0.001, t + dur);
                o.connect(g); g.connect(ac.destination); o.start(t); o.stop(t + dur + 0.02); t += dur;
            }
            // small background pad
            if (bgOsc) { bgOsc.stop(); bgOsc.disconnect(); bgGain.disconnect(); }
            bgOsc = ac.createOscillator(); bgGain = ac.createGain(); bgOsc.type = 'sine'; bgOsc.frequency.value = 220; bgGain.gain.value = 0.001; bgOsc.connect(bgGain); bgGain.connect(ac.destination);
            bgOsc.start(t0); // ramp up slightly after melody
            bgGain.gain.setValueAtTime(0.001, t);
            bgGain.gain.linearRampToValueAtTime(0.02, t + 0.5);
            // fade out after 18s
            bgGain.gain.linearRampToValueAtTime(0.0001, t + 18);
            bgOsc.stop(t + 18.05);
            // launch confetti when melody starts
            launchConfetti(60);
        }

        function playChime() {
            ensureContext(); if (ac.state === 'suspended') ac.resume(); const t = ac.currentTime + 0.02; const o1 = ac.createOscillator(), g1 = ac.createGain(); o1.type = 'triangle'; o1.frequency.setValueAtTime(880, t); g1.gain.setValueAtTime(0.0001, t); g1.gain.linearRampToValueAtTime(0.14, t + 0.01); g1.gain.exponentialRampToValueAtTime(0.0001, t + 1.2);
            o1.connect(g1); g1.connect(ac.destination); o1.start(t); o1.frequency.exponentialRampToValueAtTime(660, t + 0.45); o1.stop(t + 1.3);
            launchConfetti(50);
        }

        // Auto-trigger chime on page load
        window.addEventListener('load', ()=>{
            const btn = document.getElementById('chimeBtn');
            if(btn) btn.click();
        });

        // UI wiring
        const playBtn = document.getElementById('playBtn');
        const chimeBtn = document.getElementById('chimeBtn');
        const fileInput = document.getElementById('fileInput');
        const photoArea = document.getElementById('photoArea');

        playBtn.addEventListener('click', async () => {
            // first user interaction: resume audio context and play
            try {
                if (!ac) ensureContext(); if (ac.state === 'suspended') await ac.resume();
            } catch (e) { console.warn(e) }
            playMelody();
        });
        chimeBtn.addEventListener('click', () => { try { if (!ac) ensureContext(); if (ac.state === 'suspended') ac.resume(); } catch (e) { } playChime(); });

        // file upload: if audio file chosen, create object URL and play via audio element
        const audioEl = new Audio(); let userAudioURL = null;
        fileInput.addEventListener('change', (ev) => {
            const f = ev.target.files[0]; if (!f) return;
            if (f.type.startsWith('image')) {
                const reader = new FileReader(); 
                reader.onload = e => { 
                    photoArea.innerHTML = `<img src="${e.target.result}" alt="photo"/>`; 
                }; 
                reader.readAsDataURL(f);
            } else if (f.type.startsWith('audio')) {
                if (userAudioURL) URL.revokeObjectURL(userAudioURL);
                userAudioURL = URL.createObjectURL(f); audioEl.src = userAudioURL; audioEl.loop = false; audioEl.volume = 0.95; audioEl.play().then(() => { launchConfetti(40); }).catch(() => { /* must be user gesture */ alert('Tr√¨nh duy·ªát ch·∫∑n ph√°t t·ª± ƒë·ªông ‚Äî b·∫•m Play ƒë·ªÉ nghe.'); });
            }
        });

        // click photo to change (open file input)
        // photoArea.addEventListener('click', () => { fileInput.click(); });

        // accessibility: keyboard play
        document.addEventListener('keydown', (e) => { if (e.key === ' ') { e.preventDefault(); playMelody(); } });

        // small tip: if user taps anywhere on the card, create gentle sparkle confetti
        document.querySelector('.card').addEventListener('click', (ev) => { if (ev.target.id === 'playBtn' || ev.target.id === 'chimeBtn') return; launchConfetti(12); });

    </script>
</body>

</html>